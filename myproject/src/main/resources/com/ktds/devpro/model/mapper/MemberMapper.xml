<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktds.devpro.model.mapper.MemberMapper">
	<sql id="selectMember">
		select id,password,name,address from member
	</sql>
 	<select id="findMemberById" 
 	parameterType="string" resultType="memberVO">
 		<include refid="selectMember"/> where id=#{value}

 	</select>
 	
 	<select id="selectMemberTest"  resultType="member">
 		select t101.cust_nm as name, t101.cust_id as id, t101.cust_pwd as password, t101.cust_phone as phone, t101.cust_email as email,
 		t102.cust_prod as product, t102.cust_mbs as membership, t102.CUST_POINT , t102.cust_data_size as dataSize
		from cust_bas t101
		left join cust_dt t102
		on t101.cust_idx = t102.cust_idx
 	</select>
 	
 	<!-- 200519 결과값이 반환되지 않는 이슈 수정해야 됨. -->
 	<select id="findMemberByCustId" parameterType="string" resultType="member">
 		select cust_nm, cust_id, cust_pwd, cust_phone, cust_email from cust_bas where cust_id=#{value}
 	</select>
 	
 	<!-- 200520 11:37 security login -->
 	<select id="securityLogin" resultType="member">
		<![CDATA[
			select t101.cust_nm as name, t101.cust_id as id, t101.cust_pwd as password, t101.cust_phone as phone, t101.cust_email as email,
 		t102.cust_prod as product, t102.cust_mbs as membership, t102.CUST_POINT , t102.cust_data_size as dataSize
		from cust_bas t101
		left join cust_dt t102
		on t101.cust_idx = t102.cust_idx
		where t101.cust_id = #{id}
		]]>
	</select>
 	<select id="securityLoginByEmail" resultType="member">
		<![CDATA[
			select t101.cust_nm as name, t101.cust_id as id, t101.cust_pwd as password, t101.cust_phone as phone, t101.cust_email as email,
 		t102.cust_prod as product, t102.cust_mbs as membership, t102.CUST_POINT , t102.cust_data_size as dataSize
		from cust_bas t101
		left join cust_dt t102
		on t101.cust_idx = t102.cust_idx
		where t101.cust_email = #{email}
		]]>
	</select>
 	
 	<insert id="registerBasic" parameterType="member">
 		insert into cust_bas  (cust_nm, cust_id, cust_pwd, cust_phone, cust_email)values(#{name}, #{id}, #{password}, #{phone}, #{email})
 		<selectKey keyProperty="custIdx" resultType="int" order="AFTER">
 			select max(cust_idx) from cust_bas 
 		</selectKey>
 	</insert>
 	<insert id="registerDetail" parameterType="member">
 		insert into cust_dt  (cust_idx, cust_prod)values (#{custIdx}, "데이터ON 톡")
 	</insert>
 	<delete id= "deleteUserBasic" parameterType="member">
 		delete from cust_bas  where cust_idx = #{custIdx}
 	</delete>
 	
 	<select id ="userIdCheck" parameterType="java.lang.String" resultType="int">
 		select count(cust_id) from cust_bas where cust_id = #{user_id}
 	</select>
 	
 	<select id="securityLoginTEST" resultType="member">
		<![CDATA[
			select t101.cust_nm as name, t101.cust_id as id, t101.cust_pwd as password, t101.cust_phone as phone, t101.cust_email as email,
 		t102.cust_prod as product, t102.cust_mbs as membership, t102.CUST_POINT , t102.cust_data_size as dataSize
		from cust_bas  t101
		left join cust_dt  t102
		on t101.cust_idx = t102.cust_idx
		where t101.cust_id = #{id}
		]]>
	</select>
	
	
	<select id="selectMemberid"  resultType="String">
 		select cust_idx from cust_bas where cust_id = #{custId}
 	</select>
 	
 	
 	<insert id="InsertMemberPrize"  parameterType="String">
 		insert into cust_app_res (evt_idx, cust_idx, prize)values(#{evt_idx},#{cust_idx},#{prize});
 	</insert>
 	
 	<select id="countEventenrollment" resultType="int">
 	 	select count(*) from cust_app_res
		where cust_idx = #{cust_idx} and evt_idx in (select evt_idx from evt_evt 
		where evt_st = 1);
 	 </select>
 	 
 	 <select id="checkEventenrollment" resultType="int">
		select count(*) from cust_app_res where cust_idx = #{cust_idx} and evt_idx = #{evt_idx};
 	 </select>
 	 
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















