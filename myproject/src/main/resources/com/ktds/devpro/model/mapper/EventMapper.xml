<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktds.devpro.model.mapper.EventMapper">

	<sql id="selectEventAll">
		select EVT_IDX, EVT_NM,ST_DATE,END_DATE,EVT_ST,EVT_FILE_URL,EVT_TRG,EVT_PHONE,EVT_TRG_DATE, EVT_CTG_ID
		 from EVT_EVT
	</sql>
	
	<select id="findEventAll" 
 	 parameterType="string" resultType="EventVO">
 		<include refid="selectEventAll"/>
 	</select>
	
	<select id="findEventCur" resultType="EventVO">
 		<include refid="selectEventCur"/>
 	</select>
	
	<sql id="selectEventCur">
		 select EVT_IDX, EVT_NM,ST_DATE,END_DATE,EVT_ST,EVT_FILE_URL,EVT_TRG,EVT_PHONE,EVT_TRG_DATE, EVT_CTG_ID, EVT_CTG_NM from evt_evt 
		 join evt_ctg ON evt_evt.EVT_CTG_ID = evt_ctg.EVT_CTG_IDX
		 where EVT_ST = 1
		 LIMIT 8 offset #{pageIdx}
	</sql>
	
	<select id="findEventSt" resultType="EventVO">
 		select EVT_IDX, EVT_NM,ST_DATE,END_DATE,EVT_ST,EVT_FILE_URL,EVT_TRG,EVT_PHONE,EVT_TRG_DATE, EVT_CTG_ID, EVT_CTG_NM from evt_evt 
		 join evt_ctg ON evt_evt.EVT_CTG_ID = evt_ctg.EVT_CTG_IDX
		 where evt_evt.EVT_ST = 1 and evt_evt.EVT_CTG_ID LIKE  concat('%',#{searchOption},'%') order by evt_evt.ST_DATE DESC
		 LIMIT 8 offset #{pageIdx}
 	</select>
 	
 	<select id="findEventEnd" resultType="EventVO">
 		select EVT_IDX, EVT_NM,ST_DATE,END_DATE,EVT_ST,EVT_FILE_URL,EVT_TRG,EVT_PHONE,EVT_TRG_DATE, EVT_CTG_ID, EVT_CTG_NM from evt_evt 
		 join evt_ctg ON evt_evt.EVT_CTG_ID = evt_ctg.EVT_CTG_IDX
		 where evt_evt.EVT_ST = 1 and evt_evt.EVT_CTG_ID LIKE  concat('%',#{searchOption},'%') order by evt_evt.END_DATE ASC
		 LIMIT 8 offset #{pageIdx}
 	</select>
	
	<select id="findEventByIdx" 
 	 parameterType="int" resultType="EventVO">
 		SELECT * FROM EVT_EVT WHERE EVT_IDX =#{evtIdx};
 	</select>
 		
 	<sql id="selectEventCtgAll">
		select EVT_CTG_IDX, EVT_CTG_NM
		 from EVT_CTG
	</sql>
	
 	<select id="findEventCtgAll" 
 	 parameterType="string" resultType="EventCtgVO">
 		<include refid="selectEventCtgAll"/>
 	</select>

 	
 	<select id="findEventByCtg" 
 	 parameterType="int" resultType="EventVO">
 		SELECT * FROM EVT_EVT WHERE EVT_CTG_ID =#{ctgId};
 	</select>
 	
 	<select id="findEventIdxByEvtnm" parameterType="String" resultType="int">
       SELECT EVT_IDX FROM EVT_EVT WHERE EVT_NM=#{evt_nm};
    </select>
 	
 	<delete id="deleteEvent" 
     parameterType="int">
       DELETE FROM EVT_EVT WHERE EVT_Idx=#{evt_idx};
    </delete>

 	
 	<update id="updateEvent" parameterType="EventVO">
 		UPDATE EVT_EVT SET EVT_ST =#{EvtSt} WHERE EVT_IDX = #{EvtIdx} 
 	</update>
 	
 	<select id="searchEventDtList"
 	 parameterType="int" resultType="EventDtVO">
 		SELECT * FROM EVT_DT WHERE EVT_IDX = #{EvtIdx};
 	</select>
 	
 	<select id="searchEventListPage"
 	 parameterType="int" resultType="EventVO">
 	 	SELECT * FROM EVT_EVT LIMIT 8 offset #{pageIdx};
 	 	<!-- select * from foodlistinfo order by code limit #{pagecnt} offset #{page} -->
 	 </select>
 	
</mapper>
 
 